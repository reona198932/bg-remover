<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BG Remover & Copyright Tool</title>
<meta name="description" content="AI-powered background removal and copyright watermark tool. Free online batch image processor.">

<!-- Google AdSense (ã‚ãªãŸã®IDã«å·®ã—æ›¿ãˆã¦ãã ã•ã„) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>

<!-- Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

<script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.5.5/dist/index.umd.js"></script>
<style>
:root {
  --primary: #6366f1;
  --primary-hover: #4f46e5;
  --bg: #0f172a;
  --surface: #1e293b;
  --surface2: #334155;
  --text: #f1f5f9;
  --text-muted: #94a3b8;
  --border: #475569;
  --success: #22c55e;
  --danger: #ef4444;
  --warning: #f59e0b;
  --gold: #f59e0b;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* ---- Ad Slots ---- */
.ad-slot {
  background: var(--surface);
  border: 1px dashed var(--border);
  text-align: center;
  padding: 8px;
  min-height: 90px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
  font-size: 12px;
}

.ad-slot-header { border-bottom: 1px solid var(--border); }
.ad-slot-footer { border-top: 1px solid var(--border); margin-top: auto; }
.ad-slot.premium-hidden { display: none; }

/* ---- Header ---- */
.app-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
}

.header-left { display: flex; align-items: center; gap: 16px; }

.app-title {
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(135deg, #818cf8, #c084fc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-right { display: flex; align-items: center; gap: 12px; }

.lang-toggle {
  display: flex;
  background: var(--surface2);
  border-radius: 8px;
  overflow: hidden;
}

.lang-btn {
  padding: 6px 14px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s;
}

.lang-btn.active { background: var(--primary); color: white; }

/* ---- Plan Badge ---- */
.plan-badge {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}

.plan-badge.free { background: var(--surface2); color: var(--text-muted); }
.plan-badge.premium { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
.plan-badge:hover { opacity: 0.9; transform: translateY(-1px); }

/* ---- Hero CTA Banner ---- */
.hero-cta {
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #c026d3 100%);
  padding: 32px 24px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.hero-cta.premium-hidden { display: none; }

.hero-cta::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 30% 50%, rgba(255,255,255,0.1) 0%, transparent 70%);
}

.hero-cta-inner {
  max-width: 700px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.hero-cta-badge {
  display: inline-block;
  background: rgba(255,255,255,0.2);
  color: white;
  font-size: 12px;
  font-weight: 600;
  padding: 4px 14px;
  border-radius: 20px;
  margin-bottom: 12px;
  backdrop-filter: blur(4px);
}

.hero-cta-title {
  font-size: 22px;
  font-weight: 700;
  color: white;
  margin-bottom: 8px;
  line-height: 1.4;
}

.hero-cta-desc {
  font-size: 14px;
  color: rgba(255,255,255,0.85);
  margin-bottom: 20px;
  line-height: 1.6;
}

.hero-cta-features {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.hero-cta-feat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: rgba(255,255,255,0.9);
}

.hero-cta-feat::before {
  content: 'âœ“';
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  font-size: 11px;
  font-weight: 700;
}

.hero-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 40px;
  background: white;
  color: #4f46e5;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

.hero-cta-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 28px rgba(0,0,0,0.3);
}

.hero-cta-sub {
  font-size: 12px;
  color: rgba(255,255,255,0.6);
  margin-top: 10px;
}

/* ---- Usage Counter ---- */
.usage-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 24px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  font-size: 13px;
}

.usage-bar.premium-hidden { display: none; }
.usage-label { color: var(--text-muted); }

.usage-track {
  flex: 1;
  max-width: 200px;
  height: 6px;
  background: var(--surface2);
  border-radius: 3px;
  overflow: hidden;
}

.usage-fill { height: 100%; background: var(--primary); border-radius: 3px; transition: width 0.3s; }
.usage-fill.warning { background: var(--warning); }
.usage-fill.danger { background: var(--danger); }
.usage-count { font-weight: 600; }

.usage-upgrade {
  padding: 4px 12px;
  background: linear-gradient(135deg, #f59e0b, #ef4444);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 0.2s;
}

.usage-upgrade:hover { opacity: 0.9; }

/* ---- Main ---- */
.main-container { max-width: 1200px; margin: 0 auto; padding: 24px; }

/* Upload Zone */
.upload-zone {
  border: 2px dashed var(--border);
  border-radius: 16px;
  padding: 48px;
  text-align: center;
  transition: all 0.3s;
  cursor: pointer;
  margin-bottom: 24px;
}

.upload-zone:hover, .upload-zone.dragover {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.05);
}

.upload-icon { font-size: 48px; margin-bottom: 12px; }
.upload-text { font-size: 16px; color: var(--text-muted); margin-bottom: 8px; }
.upload-sub { font-size: 13px; color: var(--text-muted); opacity: 0.7; }

.upload-btn {
  display: inline-block;
  margin-top: 16px;
  padding: 10px 24px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.upload-btn:hover { background: var(--primary-hover); }

/* Settings Panel */
.settings-panel { background: var(--surface); border-radius: 16px; padding: 24px; margin-bottom: 24px; display: none; }
.settings-panel.show { display: block; }
.settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
@media (max-width: 768px) { .settings-grid { grid-template-columns: 1fr; } }
.setting-section { background: var(--surface2); border-radius: 12px; padding: 20px; }
.setting-title { font-size: 15px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
.setting-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
.setting-row:last-child { margin-bottom: 0; }
.setting-label { font-size: 13px; color: var(--text-muted); min-width: 80px; }

input[type="text"], input[type="number"], input[type="color"], select {
  padding: 8px 12px; background: var(--bg); border: 1px solid var(--border);
  border-radius: 6px; color: var(--text); font-size: 13px; outline: none; flex: 1;
}

input[type="color"] { width: 40px; height: 36px; padding: 2px; cursor: pointer; flex: none; }
input[type="range"] { flex: 1; accent-color: var(--primary); }
select { cursor: pointer; }
.checkbox-label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; }
.checkbox-label input[type="checkbox"] { accent-color: var(--primary); width: 16px; height: 16px; }

.logo-upload-area {
  border: 1px dashed var(--border); border-radius: 8px; padding: 12px;
  text-align: center; cursor: pointer; font-size: 12px; color: var(--text-muted); transition: border-color 0.2s;
}
.logo-upload-area:hover { border-color: var(--primary); }
.logo-preview { max-height: 40px; margin-top: 8px; }

/* Action Buttons */
.action-bar { display: none; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
.action-bar.show { display: flex; }
.action-btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
.action-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover:not(:disabled) { background: var(--primary-hover); }
.btn-success { background: var(--success); color: white; }
.btn-success:hover:not(:disabled) { background: #16a34a; }
.btn-danger { background: var(--danger); color: white; }
.btn-danger:hover:not(:disabled) { background: #dc2626; }
.btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
.btn-outline:hover:not(:disabled) { background: var(--surface2); }

/* Image Grid */
.image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; margin-bottom: 24px; }
.image-card { background: var(--surface); border-radius: 12px; overflow: hidden; border: 2px solid transparent; transition: border-color 0.2s; position: relative; }
.image-card.selected { border-color: var(--primary); }
.image-card-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--surface2); }
.image-card-name { font-size: 12px; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; }
.image-card-checkbox { accent-color: var(--primary); width: 18px; height: 18px; cursor: pointer; }
.image-card-preview { position: relative; width: 100%; aspect-ratio: 4/3; display: flex; align-items: center; justify-content: center; background: repeating-conic-gradient(#1a1a2e 0% 25%, #252540 0% 50%) 0 0 / 20px 20px; overflow: hidden; }
.image-card-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
.image-card-status { padding: 6px 12px; font-size: 11px; text-align: center; }
.status-pending { color: var(--text-muted); }
.status-processing { color: var(--warning); }
.status-done { color: var(--success); }
.status-error { color: var(--danger); }

/* Progress Bar */
.progress-bar-container { background: var(--surface); border-radius: 12px; padding: 16px 24px; margin-bottom: 24px; display: none; }
.progress-bar-container.show { display: block; }
.progress-info { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; }
.progress-track { height: 8px; background: var(--surface2); border-radius: 4px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #c084fc); border-radius: 4px; transition: width 0.3s ease; width: 0%; }

/* Select All */
.select-all-bar { display: none; justify-content: space-between; align-items: center; padding: 8px 16px; background: var(--surface); border-radius: 10px; margin-bottom: 16px; font-size: 13px; }
.select-all-bar.show { display: flex; }

/* View tabs */
.view-tabs { display: flex; gap: 4px; background: var(--bg); border-radius: 6px; padding: 2px; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); z-index: 2; }
.view-tab { padding: 4px 10px; border: none; background: transparent; color: var(--text-muted); font-size: 10px; cursor: pointer; border-radius: 4px; transition: all 0.2s; }
.view-tab.active { background: var(--primary); color: white; }

/* Spinner */
.spinner { width: 32px; height: 32px; border: 3px solid var(--surface2); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; position: absolute; z-index: 2; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Toast */
.toast { position: fixed; bottom: 24px; right: 24px; padding: 12px 20px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; font-size: 13px; z-index: 1000; transform: translateY(100px); opacity: 0; transition: all 0.3s; }
.toast.show { transform: translateY(0); opacity: 1; }

/* ---- Pricing Modal ---- */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 900; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
.modal-overlay.show { display: flex; }
.pricing-modal { background: var(--surface); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; }
.modal-close { position: absolute; top: 16px; right: 16px; background: var(--surface2); border: none; color: var(--text); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
.modal-title { text-align: center; font-size: 24px; font-weight: 700; margin-bottom: 8px; }
.modal-subtitle { text-align: center; color: var(--text-muted); font-size: 14px; margin-bottom: 32px; }
.pricing-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
@media (max-width: 600px) { .pricing-cards { grid-template-columns: 1fr; } }
.pricing-card { background: var(--surface2); border-radius: 16px; padding: 28px; border: 2px solid transparent; transition: border-color 0.2s; }
.pricing-card.featured { border-color: var(--gold); position: relative; }
.pricing-card.featured::before { content: attr(data-badge); position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; padding: 4px 16px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.pricing-plan-name { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
.pricing-price { font-size: 36px; font-weight: 700; margin-bottom: 4px; }
.pricing-price span { font-size: 14px; font-weight: 400; color: var(--text-muted); }
.pricing-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }
.pricing-features { list-style: none; margin-bottom: 24px; }
.pricing-features li { padding: 6px 0; font-size: 13px; display: flex; align-items: center; gap: 8px; }
.pricing-features li::before { content: 'âœ“'; color: var(--success); font-weight: 700; }
.pricing-cta { width: 100%; padding: 12px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
.pricing-cta.current { background: var(--surface); color: var(--text-muted); cursor: default; }
.pricing-cta.upgrade { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
.pricing-cta.upgrade:hover { opacity: 0.9; transform: translateY(-1px); }

/* ---- Limit Reached Overlay ---- */
.limit-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 800; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
.limit-overlay.show { display: flex; }
.limit-card { background: var(--surface); border-radius: 20px; padding: 40px; max-width: 440px; width: 90%; text-align: center; }
.limit-icon { font-size: 48px; margin-bottom: 16px; }
.limit-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
.limit-desc { color: var(--text-muted); font-size: 14px; margin-bottom: 24px; line-height: 1.6; }
.limit-cta { padding: 14px 32px; background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 12px; }
.limit-cta:hover { opacity: 0.9; }
.limit-dismiss { display: block; background: none; border: none; color: var(--text-muted); font-size: 13px; cursor: pointer; margin: 0 auto; }

/* ---- Footer ---- */
.app-footer { text-align: center; padding: 24px; color: var(--text-muted); font-size: 12px; border-top: 1px solid var(--border); margin-top: 40px; }
.app-footer a { color: var(--primary); text-decoration: none; }

.hidden { display: none !important; }
</style>
</head>
<body>

<!-- ===== AD: Header Banner ===== -->
<div class="ad-slot ad-slot-header" id="adHeader">
  <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<!-- ===== HEADER ===== -->
<div class="app-header">
  <div class="header-left">
    <div class="app-title">âœ¦ BG Remover & Copyright</div>
  </div>
  <div class="header-right">
    <button class="plan-badge free" id="planBadge" onclick="openPricingModal()">
      <span id="planBadgeIcon">âš¡</span>
      <span id="planBadgeText" data-i18n="planFree">Free ãƒ—ãƒ©ãƒ³</span>
    </button>
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="ja" onclick="setLang('ja')">æ—¥æœ¬èª</button>
      <button class="lang-btn" data-lang="en" onclick="setLang('en')">English</button>
    </div>
  </div>
</div>

<!-- ===== HERO CTA BANNER (Free users only) ===== -->
<div class="hero-cta" id="heroCta">
  <div class="hero-cta-inner">
    <div class="hero-cta-badge" data-i18n="heroBadge">æœŸé–“é™å®šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</div>
    <div class="hero-cta-title" data-i18n="heroTitle">PRO ãƒ—ãƒ©ãƒ³ã§ã‚‚ã£ã¨è‡ªç”±ã«ã€‚æœˆé¡ãŸã£ãŸã® Â¥490</div>
    <div class="hero-cta-desc" data-i18n="heroDesc">ç„¡åˆ¶é™ã®èƒŒæ™¯é™¤å» & ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆæŒ¿å…¥ã€‚åºƒå‘Šãªã—ã®å¿«é©ãªä½œæ¥­ç’°å¢ƒã§ã€ã‚ãªãŸã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã—ã¾ã—ã‚‡ã†ã€‚</div>
    <div class="hero-cta-features">
      <span class="hero-cta-feat" data-i18n="heroFeat1">å‡¦ç†æšæ•° ç„¡åˆ¶é™</span>
      <span class="hero-cta-feat" data-i18n="heroFeat2">åºƒå‘Šãªã—</span>
      <span class="hero-cta-feat" data-i18n="heroFeat3">å„ªå…ˆã‚µãƒãƒ¼ãƒˆ</span>
    </div>
    <button class="hero-cta-btn" onclick="openPricingModal()">
      <span data-i18n="heroBtn">âœ¦ PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</span>
    </button>
    <div class="hero-cta-sub" data-i18n="heroSub">ã„ã¤ã§ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ ãƒ» ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆå¯¾å¿œ</div>
  </div>
</div>

<!-- ===== USAGE BAR (Free users only) ===== -->
<div class="usage-bar" id="usageBar">
  <span class="usage-label" data-i18n="usageLabel">æœ¬æ—¥ã®æ®‹ã‚Šå›æ•°:</span>
  <div class="usage-track">
    <div class="usage-fill" id="usageFill" style="width: 100%"></div>
  </div>
  <span class="usage-count" id="usageCount">1 / 1</span>
  <button class="usage-upgrade" onclick="openPricingModal()" data-i18n="upgradeBtn">PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</button>
</div>

<!-- ===== MAIN ===== -->
<div class="main-container">
  <div class="upload-zone" id="uploadZone">
    <div class="upload-icon">ğŸ“</div>
    <div class="upload-text" data-i18n="uploadText">ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</div>
    <div class="upload-sub" data-i18n="uploadSub">PNG, JPG, WEBPå¯¾å¿œ ãƒ» è¤‡æ•°é¸æŠå¯</div>
    <button class="upload-btn" data-i18n="uploadBtn">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
    <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-grid">
      <div class="setting-section">
        <div class="setting-title">ğŸ”² <span data-i18n="bgTitle">èƒŒæ™¯é™¤å»</span></div>
        <div class="setting-row">
          <label class="checkbox-label">
            <input type="checkbox" id="enableBgRemoval" checked>
            <span data-i18n="enableBg">èƒŒæ™¯é™¤å»ã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
          </label>
        </div>
      </div>
      <div class="setting-section">
        <div class="setting-title">Â©ï¸ <span data-i18n="crTextTitle">ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰</span></div>
        <div class="setting-row"><label class="checkbox-label"><input type="checkbox" id="enableCopyrightText" checked><span data-i18n="enableCrText">ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹</span></label></div>
        <div class="setting-row"><span class="setting-label" data-i18n="crLabel">ãƒ†ã‚­ã‚¹ãƒˆ</span><input type="text" id="copyrightText" value="Â© 2026 Your Name" placeholder="Â© 2026 Your Name"></div>
        <div class="setting-row">
          <span class="setting-label" data-i18n="posLabel">ä½ç½®</span>
          <select id="copyrightPosition">
            <option value="bottom-right" data-i18n-opt="posBR">å³ä¸‹</option>
            <option value="bottom-left" data-i18n-opt="posBL">å·¦ä¸‹</option>
            <option value="bottom-center" data-i18n-opt="posBC">ä¸­å¤®ä¸‹</option>
            <option value="top-right" data-i18n-opt="posTR">å³ä¸Š</option>
            <option value="top-left" data-i18n-opt="posTL">å·¦ä¸Š</option>
            <option value="center" data-i18n-opt="posC">ä¸­å¤®</option>
          </select>
        </div>
        <div class="setting-row"><span class="setting-label" data-i18n="sizeLabel">ã‚µã‚¤ã‚º</span><input type="range" id="copyrightSize" min="8" max="72" value="24"><span id="sizeValue">24px</span></div>
        <div class="setting-row"><span class="setting-label" data-i18n="colorLabel">è‰²</span><input type="color" id="copyrightColor" value="#ffffff"></div>
        <div class="setting-row"><span class="setting-label" data-i18n="opacityLabel">ä¸é€æ˜åº¦</span><input type="range" id="copyrightOpacity" min="10" max="100" value="50"><span id="opacityValue">50%</span></div>
      </div>
      <div class="setting-section">
        <div class="setting-title">ğŸ–¼ï¸ <span data-i18n="crLogoTitle">ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆï¼ˆãƒ­ã‚´ï¼‰</span></div>
        <div class="setting-row"><label class="checkbox-label"><input type="checkbox" id="enableCopyrightLogo"><span data-i18n="enableCrLogo">ãƒ­ã‚´ç”»åƒã‚’æœ‰åŠ¹ã«ã™ã‚‹</span></label></div>
        <div class="logo-upload-area" id="logoUploadArea">
          <span data-i18n="logoUpload">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚´ç”»åƒã‚’é¸æŠï¼ˆPNGæ¨å¥¨ï¼‰</span>
          <input type="file" id="logoInput" accept="image/*" style="display:none">
          <div id="logoPreviewContainer"></div>
        </div>
        <div class="setting-row" style="margin-top:12px;">
          <span class="setting-label" data-i18n="logoPos">ä½ç½®</span>
          <select id="logoPosition">
            <option value="bottom-right" data-i18n-opt="posBR">å³ä¸‹</option>
            <option value="bottom-left" data-i18n-opt="posBL">å·¦ä¸‹</option>
            <option value="bottom-center" data-i18n-opt="posBC">ä¸­å¤®ä¸‹</option>
            <option value="top-right" data-i18n-opt="posTR">å³ä¸Š</option>
            <option value="top-left" data-i18n-opt="posTL">å·¦ä¸Š</option>
            <option value="center" data-i18n-opt="posC">ä¸­å¤®</option>
          </select>
        </div>
        <div class="setting-row"><span class="setting-label" data-i18n="logoSizeLabel">ã‚µã‚¤ã‚º(%)</span><input type="range" id="logoSize" min="5" max="50" value="15"><span id="logoSizeValue">15%</span></div>
        <div class="setting-row"><span class="setting-label" data-i18n="logoOpacityLabel">ä¸é€æ˜åº¦</span><input type="range" id="logoOpacity" min="10" max="100" value="60"><span id="logoOpacityValue">60%</span></div>
      </div>
      <div class="setting-section">
        <div class="setting-title">ğŸ’¾ <span data-i18n="outputTitle">å‡ºåŠ›è¨­å®š</span></div>
        <div class="setting-row"><span class="setting-label" data-i18n="formatLabel">å½¢å¼</span><select id="outputFormat"><option value="png">PNG</option><option value="jpeg">JPEG</option></select></div>
        <div class="setting-row" id="jpegQualityRow"><span class="setting-label" data-i18n="qualityLabel">å“è³ª</span><input type="range" id="jpegQuality" min="10" max="100" value="90"><span id="qualityValue">90%</span></div>
      </div>
    </div>
  </div>

  <div class="select-all-bar" id="selectAllBar">
    <label class="checkbox-label"><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"><span data-i18n="selectAll">ã™ã¹ã¦é¸æŠ</span><span id="selectionCount">(0)</span></label>
  </div>

  <div class="action-bar" id="actionBar">
    <button class="action-btn btn-primary" id="processBtn" onclick="startProcessing()">â–¶ <span data-i18n="processBtn">ä¸€æ‹¬å‡¦ç†ã‚’é–‹å§‹</span></button>
    <button class="action-btn btn-success" id="downloadBtn" onclick="downloadAll()" disabled>â¬‡ <span data-i18n="downloadBtn">ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span></button>
    <button class="action-btn btn-outline" id="addMoreBtn" onclick="document.getElementById('fileInput').click()">ï¼‹ <span data-i18n="addMore">è¿½åŠ </span></button>
    <button class="action-btn btn-danger" id="clearBtn" onclick="clearAll()">ğŸ—‘ <span data-i18n="clearBtn">ã‚¯ãƒªã‚¢</span></button>
  </div>

  <div class="progress-bar-container" id="progressContainer">
    <div class="progress-info"><span id="progressText" data-i18n="progressText">å‡¦ç†ä¸­...</span><span id="progressPercent">0%</span></div>
    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  </div>

  <div class="image-grid" id="imageGrid"></div>
</div>

<div class="app-footer">
  <p>Â© 2026 BG Remover & Copyright Tool. All rights reserved.</p>
  <p style="margin-top:4px"><a href="#" onclick="openPricingModal();return false;" data-i18n="footerUpgrade">ç„¡åˆ¶é™ã§ä½¿ã†ã«ã¯ PRO ãƒ—ãƒ©ãƒ³ã¸</a></p>
</div>

<!-- ===== AD: Footer Banner ===== -->
<div class="ad-slot ad-slot-footer" id="adFooter">
  <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<!-- ===== Pricing Modal ===== -->
<div class="modal-overlay" id="pricingModal">
  <div class="pricing-modal">
    <button class="modal-close" onclick="closePricingModal()">âœ•</button>
    <div class="modal-title" data-i18n="pricingTitle">ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ</div>
    <div class="modal-subtitle" data-i18n="pricingSubtitle">ã‚ãªãŸã«åˆã£ãŸãƒ—ãƒ©ãƒ³ã§ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†</div>
    <div class="pricing-cards">
      <div class="pricing-card">
        <div class="pricing-plan-name" data-i18n="planFreeName">Free</div>
        <div class="pricing-price">Â¥0</div>
        <div class="pricing-desc" data-i18n="planFreeDesc">ãŠè©¦ã—åˆ©ç”¨ã«æœ€é©</div>
        <ul class="pricing-features">
          <li data-i18n="feat1Free">1æ—¥1æšã¾ã§å‡¦ç†å¯èƒ½</li>
          <li data-i18n="feat2Free">èƒŒæ™¯é™¤å»ï¼‹ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ</li>
          <li data-i18n="feat3Free">PNG / JPEG å‡ºåŠ›</li>
          <li data-i18n="feat4Free">åºƒå‘Šã‚ã‚Š</li>
        </ul>
        <button class="pricing-cta current" data-i18n="currentPlan">ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³</button>
      </div>
      <div class="pricing-card featured" data-badge="POPULAR">
        <div class="pricing-plan-name" data-i18n="planProName">PRO</div>
        <div class="pricing-price">Â¥490 <span data-i18n="perMonth">/ æœˆ</span></div>
        <div class="pricing-desc" data-i18n="planProDesc">ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å‘ã‘</div>
        <ul class="pricing-features">
          <li data-i18n="feat1Pro">å‡¦ç†æšæ•°ç„¡åˆ¶é™</li>
          <li data-i18n="feat2Pro">èƒŒæ™¯é™¤å»ï¼‹ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ</li>
          <li data-i18n="feat3Pro">PNG / JPEG å‡ºåŠ›</li>
          <li data-i18n="feat4Pro">åºƒå‘Šãªã—</li>
        </ul>
        <button class="pricing-cta upgrade" id="stripeCheckoutBtn" onclick="startStripeCheckout()" data-i18n="upgradeCta">PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== Limit Reached Overlay ===== -->
<div class="limit-overlay" id="limitOverlay">
  <div class="limit-card">
    <div class="limit-icon">ğŸ”’</div>
    <div class="limit-title" data-i18n="limitTitle">æœ¬æ—¥ã®ç„¡æ–™æ ã‚’ä½¿ã„åˆ‡ã‚Šã¾ã—ãŸ</div>
    <div class="limit-desc" data-i18n="limitDesc">PRO ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥490/æœˆï¼‰ãªã‚‰æšæ•°ç„¡åˆ¶é™ãƒ»åºƒå‘Šãªã—ã§ä½¿ãˆã¾ã™ã€‚æ˜æ—¥ã¾ã§å¾…ã¤ã‹ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã™ãã«ç¶šã‘ã¾ã—ã‚‡ã†ã€‚</div>
    <button class="limit-cta" onclick="closeLimitOverlay();openPricingModal();" data-i18n="limitCta">PRO ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹ï¼ˆÂ¥490/æœˆï¼‰</button>
    <button class="limit-dismiss" onclick="closeLimitOverlay()" data-i18n="limitDismiss">æ˜æ—¥ã¾ãŸæ¥ã‚‹</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ================================================================
//  CONFIG
// ================================================================
const CONFIG = {
  DAILY_FREE_LIMIT: 1,
  PRO_PRICE_JPY: 490,
  STRIPE_PK: 'pk_test_XXXXXXXXXXXXXXXXXXXXXXXX',
  STRIPE_CHECKOUT_URL: 'https://your-api.example.com/create-checkout-session',
};

// ================================================================
//  i18n
// ================================================================
const i18n = {
  ja: {
    uploadText: 'ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ',
    uploadSub: 'PNG, JPG, WEBPå¯¾å¿œ ãƒ» è¤‡æ•°é¸æŠå¯',
    uploadBtn: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ',
    bgTitle: 'èƒŒæ™¯é™¤å»', enableBg: 'èƒŒæ™¯é™¤å»ã‚’æœ‰åŠ¹ã«ã™ã‚‹',
    crTextTitle: 'ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰', enableCrText: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹',
    crLabel: 'ãƒ†ã‚­ã‚¹ãƒˆ', posLabel: 'ä½ç½®', sizeLabel: 'ã‚µã‚¤ã‚º',
    colorLabel: 'è‰²', opacityLabel: 'ä¸é€æ˜åº¦',
    crLogoTitle: 'ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆï¼ˆãƒ­ã‚´ï¼‰', enableCrLogo: 'ãƒ­ã‚´ç”»åƒã‚’æœ‰åŠ¹ã«ã™ã‚‹',
    logoUpload: 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚´ç”»åƒã‚’é¸æŠï¼ˆPNGæ¨å¥¨ï¼‰',
    logoPos: 'ä½ç½®', logoSizeLabel: 'ã‚µã‚¤ã‚º(%)', logoOpacityLabel: 'ä¸é€æ˜åº¦',
    outputTitle: 'å‡ºåŠ›è¨­å®š', formatLabel: 'å½¢å¼', qualityLabel: 'å“è³ª',
    selectAll: 'ã™ã¹ã¦é¸æŠ',
    processBtn: 'ä¸€æ‹¬å‡¦ç†ã‚’é–‹å§‹', downloadBtn: 'ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
    addMore: 'è¿½åŠ ', clearBtn: 'ã‚¯ãƒªã‚¢', progressText: 'å‡¦ç†ä¸­...',
    statusPending: 'å¾…æ©Ÿä¸­', statusProcessing: 'å‡¦ç†ä¸­...',
    statusDone: 'å®Œäº† âœ“', statusError: 'ã‚¨ãƒ©ãƒ¼',
    original: 'ã‚ªãƒªã‚¸ãƒŠãƒ«', processed: 'å‡¦ç†æ¸ˆã¿',
    posBR: 'å³ä¸‹', posBL: 'å·¦ä¸‹', posBC: 'ä¸­å¤®ä¸‹',
    posTR: 'å³ä¸Š', posTL: 'å·¦ä¸Š', posC: 'ä¸­å¤®',
    toastAdded: 'æšã®ç”»åƒã‚’è¿½åŠ ã—ã¾ã—ãŸ',
    toastDone: 'å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ',
    toastDownloading: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...',
    loadingModel: 'AIãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­ï¼ˆåˆå›ã®ã¿æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼‰...',
    planFree: 'Free ãƒ—ãƒ©ãƒ³', planPro: 'âœ¦ PRO',
    usageLabel: 'æœ¬æ—¥ã®æ®‹ã‚Šå›æ•°:',
    upgradeBtn: 'PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰',
    pricingTitle: 'ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ',
    pricingSubtitle: 'ã‚ãªãŸã«åˆã£ãŸãƒ—ãƒ©ãƒ³ã§ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†',
    planFreeName: 'Free', planProName: 'PRO',
    planFreeDesc: 'ãŠè©¦ã—åˆ©ç”¨ã«æœ€é©', planProDesc: 'ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å‘ã‘',
    perMonth: '/ æœˆ',
    feat1Free: '1æ—¥1æšã¾ã§å‡¦ç†å¯èƒ½', feat2Free: 'èƒŒæ™¯é™¤å»ï¼‹ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ',
    feat3Free: 'PNG / JPEG å‡ºåŠ›', feat4Free: 'åºƒå‘Šã‚ã‚Š',
    feat1Pro: 'å‡¦ç†æšæ•°ç„¡åˆ¶é™', feat2Pro: 'èƒŒæ™¯é™¤å»ï¼‹ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ',
    feat3Pro: 'PNG / JPEG å‡ºåŠ›', feat4Pro: 'åºƒå‘Šãªã—',
    currentPlan: 'ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³',
    upgradeCta: 'PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰',
    limitTitle: 'æœ¬æ—¥ã®ç„¡æ–™æ ã‚’ä½¿ã„åˆ‡ã‚Šã¾ã—ãŸ',
    limitDesc: 'PRO ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥490/æœˆï¼‰ãªã‚‰æšæ•°ç„¡åˆ¶é™ãƒ»åºƒå‘Šãªã—ã§ä½¿ãˆã¾ã™ã€‚æ˜æ—¥ã¾ã§å¾…ã¤ã‹ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã™ãã«ç¶šã‘ã¾ã—ã‚‡ã†ã€‚',
    limitCta: 'PRO ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹ï¼ˆÂ¥490/æœˆï¼‰',
    limitDismiss: 'æ˜æ—¥ã¾ãŸæ¥ã‚‹',
    footerUpgrade: 'ç„¡åˆ¶é™ã§ä½¿ã†ã«ã¯ PRO ãƒ—ãƒ©ãƒ³ã¸',
    limitReached: 'ç„¡æ–™æ ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ',
    welcomePro: 'PRO ãƒ—ãƒ©ãƒ³ã¸ã‚ˆã†ã“ãï¼',
    heroBadge: 'æœŸé–“é™å®šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³',
    heroTitle: 'PRO ãƒ—ãƒ©ãƒ³ã§ã‚‚ã£ã¨è‡ªç”±ã«ã€‚æœˆé¡ãŸã£ãŸã® Â¥490',
    heroDesc: 'ç„¡åˆ¶é™ã®èƒŒæ™¯é™¤å» & ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆæŒ¿å…¥ã€‚åºƒå‘Šãªã—ã®å¿«é©ãªä½œæ¥­ç’°å¢ƒã§ã€ã‚ãªãŸã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã—ã¾ã—ã‚‡ã†ã€‚',
    heroFeat1: 'å‡¦ç†æšæ•° ç„¡åˆ¶é™', heroFeat2: 'åºƒå‘Šãªã—', heroFeat3: 'å„ªå…ˆã‚µãƒãƒ¼ãƒˆ',
    heroBtn: 'âœ¦ PRO ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰',
    heroSub: 'ã„ã¤ã§ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ ãƒ» ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆå¯¾å¿œ',
  },
  en: {
    uploadText: 'Drag & drop images here, or click to select',
    uploadSub: 'Supports PNG, JPG, WEBP ãƒ» Multiple files OK',
    uploadBtn: 'Select Files',
    bgTitle: 'Background Removal', enableBg: 'Enable background removal',
    crTextTitle: 'Copyright (Text)', enableCrText: 'Enable text copyright',
    crLabel: 'Text', posLabel: 'Position', sizeLabel: 'Size',
    colorLabel: 'Color', opacityLabel: 'Opacity',
    crLogoTitle: 'Copyright (Logo)', enableCrLogo: 'Enable logo watermark',
    logoUpload: 'Click to select logo image (PNG recommended)',
    logoPos: 'Position', logoSizeLabel: 'Size (%)', logoOpacityLabel: 'Opacity',
    outputTitle: 'Output Settings', formatLabel: 'Format', qualityLabel: 'Quality',
    selectAll: 'Select All',
    processBtn: 'Start Batch Processing', downloadBtn: 'Download All',
    addMore: 'Add More', clearBtn: 'Clear', progressText: 'Processing...',
    statusPending: 'Pending', statusProcessing: 'Processing...',
    statusDone: 'Done âœ“', statusError: 'Error',
    original: 'Original', processed: 'Processed',
    posBR: 'Bottom Right', posBL: 'Bottom Left', posBC: 'Bottom Center',
    posTR: 'Top Right', posTL: 'Top Left', posC: 'Center',
    toastAdded: ' image(s) added',
    toastDone: 'Processing complete!',
    toastDownloading: 'Downloading...',
    loadingModel: 'Loading AI model (first time may take a while)...',
    planFree: 'Free Plan', planPro: 'âœ¦ PRO',
    usageLabel: 'Remaining today:',
    upgradeBtn: 'Upgrade to PRO',
    pricingTitle: 'Choose Your Plan',
    pricingSubtitle: 'Pick the plan that works best for you',
    planFreeName: 'Free', planProName: 'PRO',
    planFreeDesc: 'Perfect for trying out', planProDesc: 'For professionals',
    perMonth: '/ mo',
    feat1Free: '1 image per day', feat2Free: 'Background removal + copyright',
    feat3Free: 'PNG / JPEG output', feat4Free: 'Ads included',
    feat1Pro: 'Unlimited processing', feat2Pro: 'Background removal + copyright',
    feat3Pro: 'PNG / JPEG output', feat4Pro: 'No ads',
    currentPlan: 'Current Plan',
    upgradeCta: 'Upgrade to PRO',
    limitTitle: "You've reached today's free limit",
    limitDesc: 'Upgrade to PRO (Â¥490/mo) for unlimited processing and no ads. Wait until tomorrow or upgrade now.',
    limitCta: 'View PRO Plan (Â¥490/mo)',
    limitDismiss: "I'll come back tomorrow",
    footerUpgrade: 'Go unlimited with PRO',
    limitReached: 'Daily limit reached',
    welcomePro: 'Welcome to PRO!',
    heroBadge: 'Limited Time Offer',
    heroTitle: 'Go PRO â€” Unlimited access for just Â¥490/mo',
    heroDesc: 'Unlimited background removal & copyright insertion. Work faster in an ad-free environment.',
    heroFeat1: 'Unlimited processing', heroFeat2: 'No ads', heroFeat3: 'Priority support',
    heroBtn: 'âœ¦ Upgrade to PRO',
    heroSub: 'Cancel anytime ãƒ» Credit card accepted',
  }
};

let currentLang = 'ja';

function setLang(lang) {
  currentLang = lang;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (i18n[lang][key]) el.textContent = i18n[lang][key];
  });
  document.querySelectorAll('[data-i18n-opt]').forEach(opt => {
    const key = opt.dataset.i18nOpt;
    if (i18n[lang][key]) opt.textContent = i18n[lang][key];
  });
  updateCardStatusTexts();
  updateUsageBar();
  updatePlanBadge();
}

function t(key) { return i18n[currentLang][key] || key; }

// ================================================================
//  Freemium / Usage Tracking
// ================================================================
function getTodayKey() { return 'bgr_usage_' + new Date().toISOString().slice(0, 10); }
function getUsedToday() { return parseInt(localStorage.getItem(getTodayKey()) || '0', 10); }
function addUsage(count) { localStorage.setItem(getTodayKey(), (getUsedToday() + count).toString()); updateUsageBar(); }
function getRemainingToday() { return isPremium() ? Infinity : Math.max(0, CONFIG.DAILY_FREE_LIMIT - getUsedToday()); }
function isPremium() { return localStorage.getItem('bgr_plan') === 'pro'; }
function setPremium(val) { localStorage.setItem('bgr_plan', val ? 'pro' : 'free'); updatePlanBadge(); updateUsageBar(); updateAds(); updateHeroCta(); }

function updateUsageBar() {
  const bar = document.getElementById('usageBar');
  const fill = document.getElementById('usageFill');
  const count = document.getElementById('usageCount');
  if (isPremium()) { bar.classList.add('premium-hidden'); return; }
  bar.classList.remove('premium-hidden');
  const used = getUsedToday();
  const remaining = CONFIG.DAILY_FREE_LIMIT - used;
  const pct = Math.max(0, (remaining / CONFIG.DAILY_FREE_LIMIT) * 100);
  fill.style.width = pct + '%';
  fill.className = 'usage-fill' + (pct <= 20 ? ' danger' : pct <= 50 ? ' warning' : '');
  count.textContent = `${Math.max(0, remaining)} / ${CONFIG.DAILY_FREE_LIMIT}`;
}

function updatePlanBadge() {
  const badge = document.getElementById('planBadge');
  const icon = document.getElementById('planBadgeIcon');
  const text = document.getElementById('planBadgeText');
  if (isPremium()) { badge.className = 'plan-badge premium'; icon.textContent = 'âœ¦'; text.textContent = t('planPro'); }
  else { badge.className = 'plan-badge free'; icon.textContent = 'âš¡'; text.textContent = t('planFree'); }
}

function updateAds() {
  const hide = isPremium();
  document.getElementById('adHeader').classList.toggle('premium-hidden', hide);
  document.getElementById('adFooter').classList.toggle('premium-hidden', hide);
}

function updateHeroCta() {
  document.getElementById('heroCta').classList.toggle('premium-hidden', isPremium());
}

// ================================================================
//  Pricing Modal
// ================================================================
function openPricingModal() { document.getElementById('pricingModal').classList.add('show'); }
function closePricingModal() { document.getElementById('pricingModal').classList.remove('show'); }
document.getElementById('pricingModal').addEventListener('click', (e) => { if (e.target === e.currentTarget) closePricingModal(); });

// ================================================================
//  Limit Overlay
// ================================================================
function showLimitOverlay() { document.getElementById('limitOverlay').classList.add('show'); }
function closeLimitOverlay() { document.getElementById('limitOverlay').classList.remove('show'); }

// ================================================================
//  Stripe Checkout
// ================================================================
async function startStripeCheckout() {
  const btn = document.getElementById('stripeCheckoutBtn');
  btn.disabled = true; btn.textContent = '...';
  try {
    // Stripe Payment Linksï¼ˆã‚µãƒ¼ãƒãƒ¼ä¸è¦ãƒ»æœ€ã‚‚ç°¡å˜ï¼‰
    window.open('https://buy.stripe.com/XXXXXXXXXXXXXX', '_blank');
  } catch (err) {
    console.error('Stripe error:', err);
    showToast('Payment error. Please try again.');
  } finally {
    btn.disabled = false; btn.textContent = t('upgradeCta');
  }
}

(function checkStripeReturn() {
  const params = new URLSearchParams(window.location.search);
  if (params.get('checkout') === 'success') {
    setPremium(true);
    showToast(t('welcomePro'));
    window.history.replaceState({}, '', window.location.pathname);
  }
})();

// ================================================================
//  Image State
// ================================================================
let images = [];
let logoImage = null;
let isProcessing = false;

const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');

uploadZone.addEventListener('click', () => fileInput.click());
uploadZone.addEventListener('dragover', (e) => { e.preventDefault(); uploadZone.classList.add('dragover'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', (e) => { e.preventDefault(); uploadZone.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
fileInput.addEventListener('change', (e) => { handleFiles(e.target.files); fileInput.value = ''; });

function handleFiles(files) {
  let count = 0;
  for (const file of files) {
    if (!file.type.startsWith('image/')) continue;
    const id = Date.now() + '-' + Math.random().toString(36).substr(2, 6);
    images.push({ id, file, originalUrl: URL.createObjectURL(file), processedUrl: null, processedBlob: null, status: 'pending', selected: true });
    count++;
  }
  if (count > 0) { showToast(count + t('toastAdded')); renderImages(); updateUI(); }
}

const logoUploadArea = document.getElementById('logoUploadArea');
const logoInput = document.getElementById('logoInput');
logoUploadArea.addEventListener('click', () => logoInput.click());
logoInput.addEventListener('change', (e) => {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    const img = new Image(); img.onload = () => { logoImage = img; }; img.src = ev.target.result;
    document.getElementById('logoPreviewContainer').innerHTML = `<img class="logo-preview" src="${ev.target.result}" alt="logo">`;
  };
  reader.readAsDataURL(file);
});

function renderImages() {
  const grid = document.getElementById('imageGrid'); grid.innerHTML = '';
  images.forEach((img) => {
    const card = document.createElement('div');
    card.className = `image-card ${img.selected ? 'selected' : ''}`;
    card.innerHTML = `
      <div class="image-card-header"><span class="image-card-name" title="${img.file.name}">${img.file.name}</span><input type="checkbox" class="image-card-checkbox" ${img.selected ? 'checked' : ''} onchange="toggleSelect('${img.id}')"></div>
      <div class="image-card-preview" id="preview-${img.id}"><img src="${img.processedUrl || img.originalUrl}" alt="">${img.status === 'processing' ? '<div class="spinner"></div>' : ''}${img.processedUrl ? `<div class="view-tabs"><button class="view-tab" onclick="showOriginal('${img.id}', this)">${t('original')}</button><button class="view-tab active" onclick="showProcessed('${img.id}', this)">${t('processed')}</button></div>` : ''}</div>
      <div class="image-card-status status-${img.status}" data-status-id="${img.id}">${getStatusText(img.status)}</div>`;
    grid.appendChild(card);
  });
}

function getStatusText(s) { return { pending: t('statusPending'), processing: t('statusProcessing'), done: t('statusDone'), error: t('statusError') }[s] || s; }
function updateCardStatusTexts() { images.forEach(img => { const el = document.querySelector(`[data-status-id="${img.id}"]`); if (el) el.textContent = getStatusText(img.status); }); }

function showOriginal(id, btn) { const img = images.find(i => i.id === id); if (!img) return; document.querySelector(`#preview-${id} img`).src = img.originalUrl; btn.parentElement.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active')); btn.classList.add('active'); }
function showProcessed(id, btn) { const img = images.find(i => i.id === id); if (!img || !img.processedUrl) return; document.querySelector(`#preview-${id} img`).src = img.processedUrl; btn.parentElement.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active')); btn.classList.add('active'); }

function toggleSelect(id) { const img = images.find(i => i.id === id); if (img) { img.selected = !img.selected; renderImages(); updateSelectionCount(); } }
function toggleSelectAll() { const checked = document.getElementById('selectAllCheckbox').checked; images.forEach(img => img.selected = checked); renderImages(); updateSelectionCount(); }
function updateSelectionCount() { const count = images.filter(i => i.selected).length; document.getElementById('selectionCount').textContent = `(${count}/${images.length})`; document.getElementById('selectAllCheckbox').checked = count === images.length; }

function updateUI() {
  const hasImages = images.length > 0;
  document.getElementById('settingsPanel').classList.toggle('show', hasImages);
  document.getElementById('actionBar').classList.toggle('show', hasImages);
  document.getElementById('selectAllBar').classList.toggle('show', hasImages);
  updateSelectionCount();
  document.getElementById('downloadBtn').disabled = !images.some(i => i.status === 'done');
}

function clearAll() { images.forEach(img => { if (img.originalUrl) URL.revokeObjectURL(img.originalUrl); if (img.processedUrl) URL.revokeObjectURL(img.processedUrl); }); images = []; renderImages(); updateUI(); }

document.getElementById('copyrightSize').addEventListener('input', e => document.getElementById('sizeValue').textContent = e.target.value + 'px');
document.getElementById('copyrightOpacity').addEventListener('input', e => document.getElementById('opacityValue').textContent = e.target.value + '%');
document.getElementById('logoSize').addEventListener('input', e => document.getElementById('logoSizeValue').textContent = e.target.value + '%');
document.getElementById('logoOpacity').addEventListener('input', e => document.getElementById('logoOpacityValue').textContent = e.target.value + '%');
document.getElementById('jpegQuality').addEventListener('input', e => document.getElementById('qualityValue').textContent = e.target.value + '%');
document.getElementById('outputFormat').addEventListener('change', e => document.getElementById('jpegQualityRow').style.display = e.target.value === 'jpeg' ? 'flex' : 'none');

// ================================================================
//  Processing
// ================================================================
async function startProcessing() {
  if (isProcessing) return;
  const selected = images.filter(i => i.selected && i.status !== 'done');
  if (selected.length === 0) return;

  const remaining = getRemainingToday();
  if (remaining <= 0) { showLimitOverlay(); return; }

  const toProcess = isPremium() ? selected : selected.slice(0, remaining);
  if (toProcess.length < selected.length) showToast(`${t('limitReached')} (${toProcess.length}/${selected.length})`);

  isProcessing = true;
  document.getElementById('processBtn').disabled = true;
  document.getElementById('progressContainer').classList.add('show');
  const enableBg = document.getElementById('enableBgRemoval').checked;
  let processed = 0;

  for (const img of toProcess) {
    img.status = 'processing'; renderImages();
    try {
      let canvas = await loadImageToCanvas(img.originalUrl);
      if (enableBg) { updateProgress(processed, toProcess.length, t('loadingModel')); canvas = await removeBackground(canvas, img.file); }
      if (document.getElementById('enableCopyrightText').checked) applyCopyrightText(canvas);
      if (document.getElementById('enableCopyrightLogo').checked && logoImage) applyCopyrightLogo(canvas);

      const format = document.getElementById('outputFormat').value;
      const quality = parseInt(document.getElementById('jpegQuality').value) / 100;
      const blob = await new Promise(resolve => canvas.toBlob(resolve, format === 'jpeg' ? 'image/jpeg' : 'image/png', quality));
      img.processedBlob = blob; img.processedUrl = URL.createObjectURL(blob); img.status = 'done';
      if (!isPremium()) addUsage(1);
    } catch (err) { console.error('Processing error:', err); img.status = 'error'; }
    processed++; updateProgress(processed, toProcess.length); renderImages();
  }

  isProcessing = false;
  document.getElementById('processBtn').disabled = false;
  document.getElementById('progressContainer').classList.remove('show');
  updateUI(); showToast(t('toastDone'));
  if (!isPremium() && getRemainingToday() <= 0 && selected.length > toProcess.length) setTimeout(showLimitOverlay, 500);
}

function updateProgress(current, total, text) {
  const pct = Math.round((current / total) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPercent').textContent = pct + '%';
  document.getElementById('progressText').textContent = text || `${current} / ${total}`;
}

function loadImageToCanvas(url) {
  return new Promise((resolve, reject) => {
    const img = new Image(); img.crossOrigin = 'anonymous';
    img.onload = () => { const c = document.createElement('canvas'); c.width = img.naturalWidth; c.height = img.naturalHeight; c.getContext('2d').drawImage(img, 0, 0); resolve(c); };
    img.onerror = reject; img.src = url;
  });
}

async function removeBackground(canvas, file) {
  const resultBlob = await imglyRemoveBackground(file, { publicPath: 'https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.5.5/dist/' });
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => { const c = document.createElement('canvas'); c.width = img.naturalWidth; c.height = img.naturalHeight; c.getContext('2d').drawImage(img, 0, 0); resolve(c); };
    img.onerror = reject; img.src = URL.createObjectURL(resultBlob);
  });
}

function applyCopyrightText(canvas) {
  const ctx = canvas.getContext('2d'); const text = document.getElementById('copyrightText').value; if (!text) return;
  const fontSize = parseInt(document.getElementById('copyrightSize').value);
  const scaledSize = Math.max(12, Math.round(fontSize * (canvas.width / 800)));
  const color = document.getElementById('copyrightColor').value;
  const opacity = parseInt(document.getElementById('copyrightOpacity').value) / 100;
  const position = document.getElementById('copyrightPosition').value;
  ctx.save(); ctx.globalAlpha = opacity;
  ctx.font = `${scaledSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
  ctx.fillStyle = color; ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = scaledSize * 0.2; ctx.shadowOffsetX = 1; ctx.shadowOffsetY = 1;
  const padding = scaledSize; let x, y;
  switch (position) {
    case 'bottom-right': ctx.textAlign = 'right'; x = canvas.width - padding; y = canvas.height - padding; break;
    case 'bottom-left': ctx.textAlign = 'left'; x = padding; y = canvas.height - padding; break;
    case 'bottom-center': ctx.textAlign = 'center'; x = canvas.width / 2; y = canvas.height - padding; break;
    case 'top-right': ctx.textAlign = 'right'; x = canvas.width - padding; y = padding + scaledSize; break;
    case 'top-left': ctx.textAlign = 'left'; x = padding; y = padding + scaledSize; break;
    case 'center': ctx.textAlign = 'center'; x = canvas.width / 2; y = canvas.height / 2; break;
  }
  ctx.fillText(text, x, y); ctx.restore();
}

function applyCopyrightLogo(canvas) {
  if (!logoImage) return; const ctx = canvas.getContext('2d');
  const sizePercent = parseInt(document.getElementById('logoSize').value) / 100;
  const opacity = parseInt(document.getElementById('logoOpacity').value) / 100;
  const position = document.getElementById('logoPosition').value;
  const logoW = canvas.width * sizePercent; const logoH = (logoImage.height / logoImage.width) * logoW; const padding = 20;
  let x, y;
  switch (position) {
    case 'bottom-right': x = canvas.width - logoW - padding; y = canvas.height - logoH - padding; break;
    case 'bottom-left': x = padding; y = canvas.height - logoH - padding; break;
    case 'bottom-center': x = (canvas.width - logoW) / 2; y = canvas.height - logoH - padding; break;
    case 'top-right': x = canvas.width - logoW - padding; y = padding; break;
    case 'top-left': x = padding; y = padding; break;
    case 'center': x = (canvas.width - logoW) / 2; y = (canvas.height - logoH) / 2; break;
  }
  ctx.save(); ctx.globalAlpha = opacity; ctx.drawImage(logoImage, x, y, logoW, logoH); ctx.restore();
}

async function downloadAll() {
  const doneImages = images.filter(i => i.status === 'done' && i.processedBlob); if (doneImages.length === 0) return;
  showToast(t('toastDownloading'));
  for (const img of doneImages) { downloadSingle(img); await new Promise(r => setTimeout(r, 300)); }
}

function downloadSingle(img) {
  const format = document.getElementById('outputFormat').value;
  const ext = format === 'jpeg' ? '.jpg' : '.png';
  const a = document.createElement('a'); a.href = img.processedUrl; a.download = img.file.name.replace(/\.[^.]+$/, '') + '_processed' + ext; a.click();
}

function showToast(msg) { const toast = document.getElementById('toast'); toast.textContent = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }

// ---- Init ----
updateUI(); updateUsageBar(); updatePlanBadge(); updateAds(); updateHeroCta();
</script>
</body>
</html>
