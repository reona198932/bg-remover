<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ËÉåÊôØÂâäÈô§ + Ëëó‰ΩúÊ®©‰øùË≠∑ AI„ÉÑ„Éº„É´„ÄÇÁ∞°Âçò„Å´ÁîªÂÉè„ÅÆËÉåÊôØ„ÇíÂâäÈô§„Åó„ÄÅËëó‰ΩúÊ®©„ÉÜ„Ç≠„Çπ„Éà„ÇÑ„É≠„Ç¥„ÇíËøΩÂä†„ÄÇ1Êó•1Êûö„Åæ„ÅßÁÑ°Êñô„ÄÇ">
    <meta name="keywords" content="ËÉåÊôØÂâäÈô§, Ëëó‰ΩúÊ®©‰øùË≠∑, ÁîªÂÉèÁ∑®ÈõÜ, AI, „ÉÑ„Éº„É´, ÈÄè„Åã„Åó, „Ç¶„Ç©„Éº„Çø„Éº„Éû„Éº„ÇØ">
    <meta name="author" content="VIERI">
    <meta name="publisher" content="VIERI">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / OGP Tags -->
    <meta property="og:title" content="ËÉåÊôØÂâäÈô§ + Ëëó‰ΩúÊ®©‰øùË≠∑„ÉÑ„Éº„É´">
    <meta property="og:description" content="ÁÑ°Êñô„ÅßAI„ÅåÁîªÂÉè„ÅÆËÉåÊôØ„ÇíÂâäÈô§„ÄÇËëó‰ΩúÊ®©„ÉÜ„Ç≠„Çπ„Éà„Å®„É≠„Ç¥„ÇíËøΩÂä†„Åó„Å¶‰øùË≠∑„ÄÇ">
    <meta property="og:image" content="https://reona198932.github.io/bg-remover/og-image.png">
    <meta property="og:url" content="https://reona198932.github.io/bg-remover/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="BG Remover Pro">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ËÉåÊôØÂâäÈô§ + Ëëó‰ΩúÊ®©‰øùË≠∑„ÉÑ„Éº„É´">
    <meta name="twitter:description" content="ÁÑ°Êñô„ÅßAI„ÅåÁîªÂÉè„ÅÆËÉåÊôØ„ÇíÂâäÈô§„ÄÇËëó‰ΩúÊ®©„ÉÜ„Ç≠„Çπ„Éà„Å®„É≠„Ç¥„ÇíËøΩÂä†„ÄÇ">
    <meta name="twitter:image" content="https://reona198932.github.io/bg-remover/og-image.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://reona198932.github.io/bg-remover/">

    <!-- Language Alternates -->
    <link rel="alternate" hreflang="ja" href="https://reona198932.github.io/bg-remover/">
    <link rel="alternate" hreflang="en" href="https://reona198932.github.io/bg-remover/?lang=en">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BG Remover">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%231a1a2e' width='180' height='180'/><text x='50%' y='50%' font-size='80' fill='%23e94560' text-anchor='middle' dominant-baseline='middle' font-weight='bold'>BR</text></svg>">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "SoftwareApplication",
        "name": "BG Remover Pro",
        "description": "AI-powered background removal and copyright protection tool",
        "url": "https://reona198932.github.io/bg-remover/",
        "applicationCategory": "Multimedia",
        "author": {
            "@type": "Organization",
            "name": "VIERI"
        },
        "offers": [
            {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "JPY",
                "name": "Free Plan",
                "description": "1 image per day"
            },
            {
                "@type": "Offer",
                "price": "490",
                "priceCurrency": "JPY",
                "name": "PRO Plan",
                "description": "Unlimited images, ad-free",
                "pricingModel": "Subscription",
                "billingDuration": "P1M"
            }
        ]
    }
    </script>

    <title>ËÉåÊôØÂâäÈô§ + Ëëó‰ΩúÊ®©‰øùË≠∑„ÉÑ„Éº„É´ | BG Remover Pro</title>

    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7090197458512511" crossorigin="anonymous"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --accent: #0f3460;
            --highlight: #e94560;
            --text-primary: #eee;
            --text-secondary: #aaa;
            --success: #00d4ff;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--accent) 100%);
            padding: 1.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--highlight) 0%, var(--success) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .lang-toggle {
            background: var(--bg-primary);
            color: var(--highlight);
            border: 1px solid var(--highlight);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-toggle:hover {
            background: var(--highlight);
            color: var(--bg-primary);
        }

        .ads-header {
            text-align: center;
            margin: 0.5rem 0;
        }

        .hero-banner {
            background: linear-gradient(135deg, var(--highlight) 0%, #ff6b8a 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 8px 24px rgba(233, 69, 96, 0.3);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
        }

        .hero-content {
            flex: 1;
            min-width: 250px;
        }

        .hero-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .hero-price {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0.5rem 0;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            margin-bottom: 1rem;
        }

        .hero-cta {
            background: white;
            color: var(--highlight);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hero-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .hero-banner.hidden {
            display: none;
        }

        .usage-section {
            background: var(--bg-secondary);
            padding: 1.5rem;
            margin: 1rem;
            border-radius: 12px;
            border-left: 4px solid var(--highlight);
        }

        .usage-section.hidden {
            display: none;
        }

        .usage-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .usage-bar {
            background: var(--accent);
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .usage-fill {
            background: linear-gradient(90deg, var(--highlight) 0%, var(--success) 100%);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            transition: width 0.3s ease;
            width: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .hero-banner {
                flex-direction: column;
            }
        }

        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--highlight);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-zone {
            border: 2px dashed var(--highlight);
            border-radius: 12px;
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(233, 69, 96, 0.05);
        }

        .upload-zone:hover {
            background: rgba(233, 69, 96, 0.1);
            border-color: var(--success);
        }

        .upload-zone.dragover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--success);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .file-input {
            display: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--highlight);
        }

        input[type="text"],
        input[type="number"],
        input[type="color"],
        select {
            width: 100%;
            padding: 0.75rem;
            background: var(--accent);
            color: var(--text-primary);
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="color"]:focus,
        select:focus {
            outline: none;
            border-color: var(--highlight);
            box-shadow: 0 0 8px rgba(233, 69, 96, 0.3);
        }

        input[type="color"] {
            padding: 0.3rem;
            height: 45px;
            cursor: pointer;
        }

        .slider-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--accent);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--highlight);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(233, 69, 96, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--highlight);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(233, 69, 96, 0.4);
        }

        .value-display {
            min-width: 50px;
            text-align: right;
            font-weight: 600;
            color: var(--highlight);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--highlight) 0%, #ff6b8a 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 69, 96, 0.3);
        }

        .btn-secondary {
            background: var(--accent);
            color: var(--text-primary);
            border: 1px solid var(--highlight);
        }

        .btn-secondary:hover {
            background: var(--highlight);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--highlight);
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .gallery-item {
            background: var(--bg-secondary);
            border: 1px solid var(--accent);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(233, 69, 96, 0.2);
        }

        .gallery-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--accent);
        }

        .gallery-actions {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .gallery-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .download-btns {
            display: flex;
            gap: 0.5rem;
        }

        .download-btn {
            flex: 1;
            padding: 0.5rem;
            background: var(--accent);
            color: var(--text-primary);
            border: 1px solid var(--highlight);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: var(--highlight);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--accent);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--highlight);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--highlight);
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        @media (max-width: 600px) {
            .pricing-grid {
                grid-template-columns: 1fr;
            }
        }

        .pricing-card {
            background: var(--accent);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .pricing-card.pro {
            border-color: var(--highlight);
            background: rgba(233, 69, 96, 0.1);
            transform: scale(1.05);
        }

        .pricing-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--highlight);
        }

        .pricing-price {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--success);
        }

        .pricing-features {
            list-style: none;
            margin: 1.5rem 0;
            text-align: left;
        }

        .pricing-features li {
            padding: 0.5rem 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pricing-features li:before {
            content: "‚úì";
            color: var(--success);
            font-weight: 700;
            min-width: 20px;
        }

        .pricing-button {
            width: 100%;
            padding: 0.8rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: var(--accent);
            color: var(--text-primary);
        }

        .pricing-button.pro {
            background: linear-gradient(135deg, var(--highlight) 0%, #ff6b8a 100%);
            color: white;
        }

        .pricing-button:hover {
            transform: translateY(-2px);
        }

        .limit-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 2rem;
            padding: 1rem;
        }

        .limit-overlay.active {
            display: flex;
        }

        .limit-message {
            text-align: center;
        }

        .limit-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .limit-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--highlight);
        }

        .limit-text {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 400px;
        }

        .limit-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .ads-footer {
            text-align: center;
            margin: 2rem 0;
        }

        .footer {
            background: var(--bg-secondary);
            padding: 2rem 1rem;
            text-align: center;
            border-top: 1px solid var(--accent);
            color: var(--text-secondary);
            margin-top: 3rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .footer a {
            color: var(--highlight);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: var(--success);
        }

        .result-format-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .preview-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: var(--accent);
            border-radius: 8px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .preview-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%230f3460" width="100" height="100"/><circle cx="50" cy="50" r="10" fill="%23333333" opacity="0.3"/></svg>');
        }

        .success-message {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .feature-comparison {
            margin-top: 2rem;
            overflow-x: auto;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--accent);
        }

        .comparison-table th {
            background: var(--accent);
            font-weight: 700;
            color: var(--highlight);
        }

        .comparison-table td {
            color: var(--text-primary);
        }

        .check-mark {
            color: var(--success);
            font-weight: 700;
        }

        .x-mark {
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .header-left {
                width: 100%;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .app-title {
                font-size: 1.4rem;
            }

            .hero-title {
                font-size: 1.4rem;
            }

            .hero-price {
                font-size: 1.8rem;
            }

            .hero-banner {
                padding: 1.5rem 1rem;
            }

            .container {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="app-title">BG Remover Pro</h1>
        </div>
        <div class="header-right">
            <button class="lang-toggle" id="langToggle"></button>
        </div>
    </header>

    <!-- AdSense Header Slot -->
    <div class="ads-header">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7090197458512511"
             data-ad-slot="7890123456"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- Hero Banner (visible only for free users) -->
    <div class="hero-banner" id="heroBanner">
        <div class="hero-content">
            <div class="hero-title" id="heroTitle"></div>
            <div class="hero-subtitle" id="heroSubtitle"></div>
            <div class="hero-price" id="heroPrice"></div>
        </div>
        <button class="hero-cta" id="heroCtaBtn"></button>
    </div>

    <!-- Usage Bar (visible only for free users) -->
    <div class="usage-section" id="usageSection">
        <div class="usage-label" id="usageLabel"></div>
        <div class="usage-bar">
            <div class="usage-fill" id="usageFill"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <!-- Upload Panel -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>üì§</span>
                    <span id="uploadTitle"></span>
                </h2>

                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üñºÔ∏è</div>
                    <div class="upload-text" id="uploadText"></div>
                    <div class="upload-hint" id="uploadHint"></div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>

                <!-- File Count Info -->
                <div id="fileCountInfo" style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem; display: none;">
                    <span id="fileCountText"></span>
                </div>
            </div>

            <!-- Settings Panel -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>‚öôÔ∏è</span>
                    <span id="settingsTitle"></span>
                </h2>

                <!-- Background Removal Toggle -->
                <div class="form-group">
                    <label class="form-label">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="bgRemovalToggle" class="checkbox" checked>
                            <span id="bgRemovalLabel"></span>
                        </div>
                    </label>
                </div>

                <!-- Output Format -->
                <div class="form-group">
                    <label class="form-label" id="outputFormatLabel"></label>
                    <select id="outputFormat">
                        <option value="png">PNG (Transparent)</option>
                        <option value="jpeg">JPEG (White BG)</option>
                    </select>
                </div>

                <!-- Copyright Text Settings -->
                <div class="form-group">
                    <label class="form-label">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="textToggle" class="checkbox">
                            <span id="textOverlayLabel"></span>
                        </div>
                    </label>
                </div>

                <div id="textSettings" style="display: none; padding: 1rem; background: var(--accent); border-radius: 8px; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label class="form-label" id="copyrightTextLabel"></label>
                        <input type="text" id="copyrightText" placeholder="¬© 2024 VIERI">
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="textColorLabel"></label>
                        <input type="color" id="textColor" value="#ffffff">
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="textSizeLabel"></label>
                        <div class="slider-group">
                            <input type="range" id="textSize" min="10" max="100" value="40">
                            <div class="value-display" id="textSizeValue">40px</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="textOpacityLabel"></label>
                        <div class="slider-group">
                            <input type="range" id="textOpacity" min="0" max="100" value="80">
                            <div class="value-display" id="textOpacityValue">80%</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="textPositionLabel"></label>
                        <select id="textPosition">
                            <option value="bottom-right" id="pos-br"></option>
                            <option value="bottom-left" id="pos-bl"></option>
                            <option value="top-right" id="pos-tr"></option>
                            <option value="top-left" id="pos-tl"></option>
                            <option value="center" id="pos-center"></option>
                        </select>
                    </div>
                </div>

                <!-- Logo Settings -->
                <div class="form-group">
                    <label class="form-label">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="logoToggle" class="checkbox">
                            <span id="logoOverlayLabel"></span>
                        </div>
                    </label>
                </div>

                <div id="logoSettings" style="display: none; padding: 1rem; background: var(--accent); border-radius: 8px; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label class="form-label" id="logoUploadLabel"></label>
                        <div class="upload-zone" id="logoUploadZone" style="padding: 1.5rem 1rem; border-width: 1px;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üñºÔ∏è</div>
                            <div id="logoUploadText"></div>
                        </div>
                        <input type="file" id="logoInput" class="file-input" accept="image/*">
                        <div id="logoFileName" style="margin-top: 0.5rem; color: var(--success); font-size: 0.85rem;"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="logoOpacityLabel"></label>
                        <div class="slider-group">
                            <input type="range" id="logoOpacity" min="0" max="100" value="80">
                            <div class="value-display" id="logoOpacityValue">80%</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="logoPositionLabel"></label>
                        <select id="logoPosition">
                            <option value="bottom-right" id="logPos-br"></option>
                            <option value="bottom-left" id="logPos-bl"></option>
                            <option value="top-right" id="logPos-tr"></option>
                            <option value="top-left" id="logPos-tl"></option>
                            <option value="center" id="logPos-center"></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="logoSizeLabel"></label>
                        <div class="slider-group">
                            <input type="range" id="logoSize" min="20" max="300" value="100">
                            <div class="value-display" id="logoSizeValue">100px</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Process Button -->
        <div class="button-group">
            <button class="btn btn-primary" id="processBtn"></button>
            <button class="btn btn-secondary" id="resetBtn"></button>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <span id="successText"></span>
        </div>

        <!-- Results Gallery -->
        <div id="resultsSection" style="display: none;">
            <h2 class="panel-title" style="margin-top: 2rem;">
                <span>‚úÖ</span>
                <span id="resultsTitle"></span>
            </h2>
            <div class="gallery" id="gallery"></div>
        </div>
    </div>

    <!-- AdSense Footer Slot -->
    <div class="ads-footer">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7090197458512511"
             data-ad-slot="9876543210"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="#privacy" id="privacyLink"></a>
            <a href="#terms" id="termsLink"></a>
            <a href="#contact" id="contactLink"></a>
        </div>
        <p>&copy; 2024 VIERI. All rights reserved.</p>
    </footer>

    <!-- Pricing Modal -->
    <div class="modal" id="pricingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pricingTitle"></h2>
                <button class="close-btn" id="closePricingModal">&times;</button>
            </div>

            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="pricing-name" id="freePlanName"></div>
                    <div class="pricing-price" id="freePrice"></div>
                    <ul class="pricing-features" id="freePlanFeatures"></ul>
                    <button class="pricing-button" id="freeSelectBtn"></button>
                </div>

                <div class="pricing-card pro">
                    <div class="pricing-name" id="proPlanName"></div>
                    <div class="pricing-price" id="proPrice"></div>
                    <ul class="pricing-features" id="proPlanFeatures"></ul>
                    <button class="pricing-button pro" id="proSelectBtn"></button>
                </div>
            </div>

            <div class="feature-comparison">
                <h3 id="comparisonTitle"></h3>
                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr>
                            <th id="featureHeader"></th>
                            <th id="freeHeader"></th>
                            <th id="proHeader"></th>
                        </tr>
                    </thead>
                    <tbody id="comparisonBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Limit Reached Overlay -->
    <div class="limit-overlay" id="limitOverlay">
        <div class="limit-message">
            <div class="limit-icon">üîí</div>
            <h2 class="limit-title" id="limitTitle"></h2>
            <p class="limit-text" id="limitText"></p>
        </div>
        <div class="limit-buttons">
            <button class="btn btn-primary" id="upgradeLimitBtn"></button>
            <button class="btn btn-secondary" id="closeLimitBtn"></button>
        </div>
    </div>

    <!-- Background Removal Library -->
    <script async src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@3.0.0/dist/index.umd.js"></script>

    <script>
        // =========================
        // CONFIG
        // =========================
        const CONFIG = {
            DAILY_FREE_LIMIT: 1,
            PRO_PRICE_JPY: 490,
            STRIPE_PAYMENT_URL: 'https://buy.stripe.com/6oU9AT2169o46SG6EndZ600',
        };

        // =========================
        // TRANSLATIONS
        // =========================
        const translations = {
            ja: {
                uploadTitle: 'ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ',
                uploadText: '„Åì„Åì„Å´ÁîªÂÉè„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó',
                uploadHint: '„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû',
                settingsTitle: 'Ë®≠ÂÆö',
                bgRemovalLabel: 'ËÉåÊôØÂâäÈô§„ÇíÊúâÂäπ„Å´„Åô„Çã',
                outputFormatLabel: 'Âá∫ÂäõÂΩ¢Âºè',
                textOverlayLabel: 'Ëëó‰ΩúÊ®©„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†',
                copyrightTextLabel: '„ÉÜ„Ç≠„Çπ„ÉàÂÜÖÂÆπ',
                textColorLabel: '„ÉÜ„Ç≠„Çπ„ÉàËâ≤',
                textSizeLabel: '„ÉÜ„Ç≠„Çπ„Éà„Çµ„Ç§„Ç∫',
                textOpacityLabel: '„ÉÜ„Ç≠„Çπ„ÉàÈÄèÊòéÂ∫¶',
                textPositionLabel: '„ÉÜ„Ç≠„Çπ„Éà‰ΩçÁΩÆ',
                logoOverlayLabel: '„É≠„Ç¥„Éª„Ç¶„Ç©„Éº„Çø„Éº„Éû„Éº„ÇØ„ÇíËøΩÂä†',
                logoUploadLabel: '„É≠„Ç¥„ÇíÈÅ∏Êäû',
                logoUploadText: '„É≠„Ç¥ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ',
                logoOpacityLabel: '„É≠„Ç¥ÈÄèÊòéÂ∫¶',
                logoPositionLabel: '„É≠„Ç¥‰ΩçÁΩÆ',
                logoSizeLabel: '„É≠„Ç¥„Çµ„Ç§„Ç∫',
                processBtn: 'Âá¶ÁêÜ„ÇíÈñãÂßã',
                resetBtn: '„É™„Çª„ÉÉ„Éà',
                resultsTitle: 'Âá¶ÁêÜÂÆå‰∫Ü',
                downloadPNG: 'PNG „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ',
                downloadJPEG: 'JPEG „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ',
                successText: '‚úÖ ÁîªÂÉè„ÅÆÂá¶ÁêÜ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ',
                usageLabel: 'Êú¨Êó•„ÅÆ‰ΩøÁî®ÂõûÊï∞: {current}/{total}',
                heroTitle: 'Âà∂Èôê„Å´ÈÅî„Åó„Åæ„Åó„Åü',
                heroSubtitle: 'PRO„Éó„É©„É≥„ÅßÁÑ°Âà∂Èôê„Å´ÁîªÂÉè„ÇíÂá¶ÁêÜ',
                heroPrice: '¬•490/Êúà',
                heroCtaBtn: '„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ',
                pricingTitle: '„Éó„É©„É≥ÈÅ∏Êäû',
                freePlanName: '„Éï„É™„Éº',
                freePrice: '¬•0',
                proPlanName: 'PRO',
                proPrice: '¬•490/Êúà',
                freeSelectBtn: 'ÁèæÂú®„ÅÆ„Éó„É©„É≥',
                proSelectBtn: '‰ªä„Åô„Åê„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ',
                comparisonTitle: 'Ê©üËÉΩÊØîËºÉ',
                featureHeader: 'Ê©üËÉΩ',
                freeHeader: '„Éï„É™„Éº',
                proHeader: 'PRO',
                dailyLimit: '1Êó•„ÅÆÂá¶ÁêÜÂà∂Èôê',
                bgRemovalFeature: 'AIËÉåÊôØÂâäÈô§',
                copyrightText: 'Ëëó‰ΩúÊ®©„ÉÜ„Ç≠„Çπ„ÉàËøΩÂä†',
                logoWatermark: '„É≠„Ç¥„Éª„Ç¶„Ç©„Éº„Çø„Éº„Éû„Éº„ÇØ',
                batchProcessing: '„Éê„ÉÉ„ÉÅÂá¶ÁêÜ',
                ads: 'Â∫ÉÂëäË°®Á§∫',
                unlimited: 'ÁÑ°Âà∂Èôê',
                limited: '1Êûö/Êó•',
                included: '„ÅÇ„Çä',
                notIncluded: '„Å™„Åó',
                ads_yes: '„ÅÇ„Çä',
                ads_no: '„Å™„Åó',
                limitTitle: 'Âà∂Èôê„Å´ÈÅî„Åó„Åæ„Åó„Åü',
                limitText: '„Éï„É™„Éº„Éó„É©„É≥„Åß„ÅØ1Êó•„Å´1Êûö„Åæ„Åß„ÅÆÂá¶ÁêÜ„Åå„Åß„Åç„Åæ„Åô„ÄÇÊòéÊó•ÂÜçÂ∫¶Âá¶ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇ',
                upgradeLimitBtn: 'PRO„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ',
                closeLimitBtn: 'Èñâ„Åò„Çã',
                privacyLink: '„Éó„É©„Ç§„Éê„Ç∑„Éº',
                termsLink: 'Âà©Áî®Ë¶èÁ¥Ñ',
                contactLink: '„ÅäÂïè„ÅÑÂêà„Çè„Åõ',
                langToggle: 'English',
                pos_br: 'Âè≥‰∏ã',
                pos_bl: 'Â∑¶‰∏ã',
                pos_tr: 'Âè≥‰∏ä',
                pos_tl: 'Â∑¶‰∏ä',
                pos_center: '‰∏≠Â§Æ',
                fileCountText: '{count}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô',
            },
            en: {
                uploadTitle: 'Upload Images',
                uploadText: 'Drag & drop images here',
                uploadHint: 'or click to select files',
                settingsTitle: 'Settings',
                bgRemovalLabel: 'Enable background removal',
                outputFormatLabel: 'Output format',
                textOverlayLabel: 'Add copyright text',
                copyrightTextLabel: 'Text content',
                textColorLabel: 'Text color',
                textSizeLabel: 'Text size',
                textOpacityLabel: 'Text opacity',
                textPositionLabel: 'Text position',
                logoOverlayLabel: 'Add logo/watermark',
                logoUploadLabel: 'Select logo',
                logoUploadText: 'Upload logo image',
                logoOpacityLabel: 'Logo opacity',
                logoPositionLabel: 'Logo position',
                logoSizeLabel: 'Logo size',
                processBtn: 'Start Processing',
                resetBtn: 'Reset',
                resultsTitle: 'Results',
                downloadPNG: 'Download PNG',
                downloadJPEG: 'Download JPEG',
                successText: '‚úÖ Processing complete!',
                usageLabel: 'Usage today: {current}/{total}',
                heroTitle: 'Limit reached',
                heroSubtitle: 'Upgrade to PRO for unlimited processing',
                heroPrice: '¬•490/month',
                heroCtaBtn: 'Upgrade',
                pricingTitle: 'Select Plan',
                freePlanName: 'Free',
                freePrice: '¬•0',
                proPlanName: 'PRO',
                proPrice: '¬•490/month',
                freeSelectBtn: 'Current Plan',
                proSelectBtn: 'Upgrade Now',
                comparisonTitle: 'Feature Comparison',
                featureHeader: 'Feature',
                freeHeader: 'Free',
                proHeader: 'PRO',
                dailyLimit: 'Daily processing limit',
                bgRemovalFeature: 'AI background removal',
                copyrightText: 'Copyright text overlay',
                logoWatermark: 'Logo watermark',
                batchProcessing: 'Batch processing',
                ads: 'Ad display',
                unlimited: 'Unlimited',
                limited: '1 per day',
                included: 'Included',
                notIncluded: 'Not included',
                ads_yes: 'Yes',
                ads_no: 'No',
                limitTitle: 'Limit reached',
                limitText: 'Free plan allows 1 image per day. You can process again tomorrow.',
                upgradeLimitBtn: 'Upgrade to PRO',
                closeLimitBtn: 'Close',
                privacyLink: 'Privacy',
                termsLink: 'Terms',
                contactLink: 'Contact',
                langToggle: 'Êó•Êú¨Ë™û',
                pos_br: 'Bottom right',
                pos_bl: 'Bottom left',
                pos_tr: 'Top right',
                pos_tl: 'Top left',
                pos_center: 'Center',
                fileCountText: '{count} file(s) selected',
            }
        };

        // =========================
        // STATE MANAGEMENT
        // =========================
        let currentLanguage = localStorage.getItem('language') || 'ja';
        let isPRO = new URLSearchParams(window.location.search).has('pro');
        let selectedFiles = [];
        let logoImage = null;
        let processedResults = [];

        // Persist PRO status
        if (isPRO) {
            localStorage.setItem('isPRO', 'true');
        } else {
            isPRO = localStorage.getItem('isPRO') === 'true';
        }

        // =========================
        // TRANSLATION FUNCTION
        // =========================
        function t(key) {
            let text = translations[currentLanguage][key] || key;

            // Support parameterized translations
            arguments.length > 1 && Object.keys(arguments).slice(1).forEach((i) => {
                text = text.replace(`{${Object.keys(arguments)[i]}}`, arguments[i]);
            });

            return text;
        }

        // Better parameter replacement
        function tParam(key, params) {
            let text = translations[currentLanguage][key] || key;
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }

        // =========================
        // UI INITIALIZATION
        // =========================
        function initUI() {
            // Update all UI text
            document.getElementById('uploadTitle').textContent = t('uploadTitle');
            document.getElementById('uploadText').textContent = t('uploadText');
            document.getElementById('uploadHint').textContent = t('uploadHint');
            document.getElementById('settingsTitle').textContent = t('settingsTitle');
            document.getElementById('bgRemovalLabel').textContent = t('bgRemovalLabel');
            document.getElementById('outputFormatLabel').textContent = t('outputFormatLabel');
            document.getElementById('textOverlayLabel').textContent = t('textOverlayLabel');
            document.getElementById('copyrightTextLabel').textContent = t('copyrightTextLabel');
            document.getElementById('textColorLabel').textContent = t('textColorLabel');
            document.getElementById('textSizeLabel').textContent = t('textSizeLabel');
            document.getElementById('textOpacityLabel').textContent = t('textOpacityLabel');
            document.getElementById('textPositionLabel').textContent = t('textPositionLabel');
            document.getElementById('logoOverlayLabel').textContent = t('logoOverlayLabel');
            document.getElementById('logoUploadLabel').textContent = t('logoUploadLabel');
            document.getElementById('logoUploadText').textContent = t('logoUploadText');
            document.getElementById('logoOpacityLabel').textContent = t('logoOpacityLabel');
            document.getElementById('logoPositionLabel').textContent = t('logoPositionLabel');
            document.getElementById('logoSizeLabel').textContent = t('logoSizeLabel');
            document.getElementById('processBtn').textContent = t('processBtn');
            document.getElementById('resetBtn').textContent = t('resetBtn');
            document.getElementById('resultsTitle').textContent = t('resultsTitle');
            document.getElementById('successText').textContent = t('successText');
            document.getElementById('pricingTitle').textContent = t('pricingTitle');
            document.getElementById('freePlanName').textContent = t('freePlanName');
            document.getElementById('freePrice').textContent = t('freePrice');
            document.getElementById('proPlanName').textContent = t('proPlanName');
            document.getElementById('proPrice').textContent = t('proPrice');
            document.getElementById('freeSelectBtn').textContent = t('freeSelectBtn');
            document.getElementById('proSelectBtn').textContent = t('proSelectBtn');
            document.getElementById('comparisonTitle').textContent = t('comparisonTitle');
            document.getElementById('featureHeader').textContent = t('featureHeader');
            document.getElementById('freeHeader').textContent = t('freeHeader');
            document.getElementById('proHeader').textContent = t('proHeader');
            document.getElementById('limitTitle').textContent = t('limitTitle');
            document.getElementById('limitText').textContent = t('limitText');
            document.getElementById('upgradeLimitBtn').textContent = t('upgradeLimitBtn');
            document.getElementById('closeLimitBtn').textContent = t('closeLimitBtn');
            document.getElementById('privacyLink').textContent = t('privacyLink');
            document.getElementById('termsLink').textContent = t('termsLink');
            document.getElementById('contactLink').textContent = t('contactLink');
            document.getElementById('langToggle').textContent = t('langToggle');
            document.getElementById('heroTitle').textContent = t('heroTitle');
            document.getElementById('heroSubtitle').textContent = t('heroSubtitle');
            document.getElementById('heroPrice').textContent = t('heroPrice');
            document.getElementById('heroCtaBtn').textContent = t('heroCtaBtn');

            // Position options
            document.getElementById('pos-br').textContent = t('pos_br');
            document.getElementById('pos-bl').textContent = t('pos_bl');
            document.getElementById('pos-tr').textContent = t('pos_tr');
            document.getElementById('pos-tl').textContent = t('pos_tl');
            document.getElementById('pos-center').textContent = t('pos_center');
            document.getElementById('logPos-br').textContent = t('pos_br');
            document.getElementById('logPos-bl').textContent = t('pos_bl');
            document.getElementById('logPos-tr').textContent = t('pos_tr');
            document.getElementById('logPos-tl').textContent = t('pos_tl');
            document.getElementById('logPos-center').textContent = t('pos_center');

            // Update usage bar
            updateUsageBar();

            // Update UI visibility based on PRO status
            updateProUI();

            // Build comparison table
            buildComparisonTable();
        }

        function updateUsageBar() {
            const usage = getDailyUsage();
            const label = tParam('usageLabel', { current: usage, total: CONFIG.DAILY_FREE_LIMIT });
            document.getElementById('usageLabel').textContent = label;

            const percentage = (usage / CONFIG.DAILY_FREE_LIMIT) * 100;
            const fill = document.getElementById('usageFill');
            fill.style.width = percentage + '%';
            fill.textContent = `${usage}/${CONFIG.DAILY_FREE_LIMIT}`;
        }

        function updateProUI() {
            const heroBanner = document.getElementById('heroBanner');
            const usageSection = document.getElementById('usageSection');
            const processBtn = document.getElementById('processBtn');

            if (isPRO) {
                heroBanner.classList.add('hidden');
                usageSection.classList.add('hidden');
            } else {
                heroBanner.classList.remove('hidden');
                usageSection.classList.remove('hidden');
            }
        }

        function buildComparisonTable() {
            const tbody = document.getElementById('comparisonBody');
            tbody.innerHTML = '';

            const features = [
                { name: 'dailyLimit', free: t('limited'), pro: t('unlimited') },
                { name: 'bgRemovalFeature', free: t('included'), pro: t('included') },
                { name: 'copyrightText', free: t('included'), pro: t('included') },
                { name: 'logoWatermark', free: t('included'), pro: t('included') },
                { name: 'batchProcessing', free: t('included'), pro: t('included') },
                { name: 'ads', free: t('ads_yes'), pro: t('ads_no') },
            ];

            features.forEach(feature => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${t(feature.name)}</td>
                    <td>${feature.free}</td>
                    <td class="check-mark">${feature.pro}</td>
                `;
            });
        }

        // =========================
        // DAILY USAGE TRACKING
        // =========================
        function getDailyUsage() {
            const today = new Date().toDateString();
            const stored = JSON.parse(localStorage.getItem('dailyUsage') || '{}');

            if (stored.date !== today) {
                return 0;
            }

            return stored.count || 0;
        }

        function incrementDailyUsage() {
            const today = new Date().toDateString();
            const stored = JSON.parse(localStorage.getItem('dailyUsage') || '{}');

            if (stored.date !== today) {
                stored.date = today;
                stored.count = 0;
            }

            stored.count++;
            localStorage.setItem('dailyUsage', JSON.stringify(stored));
        }

        function canProcessImage() {
            if (isPRO) return true;
            return getDailyUsage() < CONFIG.DAILY_FREE_LIMIT;
        }

        // =========================
        // FILE HANDLING
        // =========================
        function setupFileHandling() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            const logoZone = document.getElementById('logoUploadZone');
            const logoInput = document.getElementById('logoInput');

            // Upload zone - main images
            uploadZone.addEventListener('click', () => fileInput.click());
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFileSelect(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                handleFileSelect(e.target.files);
            });

            // Logo zone
            logoZone.addEventListener('click', () => logoInput.click());
            logoZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                logoZone.classList.add('dragover');
            });
            logoZone.addEventListener('dragleave', () => {
                logoZone.classList.remove('dragover');
            });
            logoZone.addEventListener('drop', (e) => {
                e.preventDefault();
                logoZone.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    handleLogoSelect(e.dataTransfer.files[0]);
                }
            });

            logoInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleLogoSelect(e.target.files[0]);
                }
            });
        }

        function handleFileSelect(files) {
            selectedFiles = Array.from(files).filter(file => file.type.startsWith('image/'));

            if (selectedFiles.length > 0) {
                const fileCountInfo = document.getElementById('fileCountInfo');
                fileCountInfo.style.display = 'block';
                document.getElementById('fileCountText').textContent = tParam('fileCountText', { count: selectedFiles.length });
            }
        }

        function handleLogoSelect(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    logoImage = img;
                    document.getElementById('logoFileName').textContent = `‚úì ${file.name}`;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // =========================
        // SETTINGS HANDLERS
        // =========================
        function setupSettingsHandlers() {
            // Text toggle
            document.getElementById('textToggle').addEventListener('change', (e) => {
                document.getElementById('textSettings').style.display = e.target.checked ? 'block' : 'none';
            });

            // Logo toggle
            document.getElementById('logoToggle').addEventListener('change', (e) => {
                document.getElementById('logoSettings').style.display = e.target.checked ? 'block' : 'none';
            });

            // Text size slider
            document.getElementById('textSize').addEventListener('input', (e) => {
                document.getElementById('textSizeValue').textContent = e.target.value + 'px';
            });

            // Text opacity slider
            document.getElementById('textOpacity').addEventListener('input', (e) => {
                document.getElementById('textOpacityValue').textContent = e.target.value + '%';
            });

            // Logo opacity slider
            document.getElementById('logoOpacity').addEventListener('input', (e) => {
                document.getElementById('logoOpacityValue').textContent = e.target.value + '%';
            });

            // Logo size slider
            document.getElementById('logoSize').addEventListener('input', (e) => {
                document.getElementById('logoSizeValue').textContent = e.target.value + 'px';
            });
        }

        // =========================
        // IMAGE PROCESSING
        // =========================
        async function processImage(file) {
            const img = new Image();
            img.crossOrigin = 'anonymous';

            return new Promise((resolve) => {
                img.onload = async () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');

                    // Draw original image
                    ctx.drawImage(img, 0, 0);

                    // Remove background if enabled
                    if (document.getElementById('bgRemovalToggle').checked) {
                        try {
                            const imglyRemoval = window.removeBackground || window.imgly?.removeBackground;
                            if (imglyRemoval) {
                                const blob = await imglyRemoval(canvas);
                                const bgRemovedImg = new Image();
                                bgRemovedImg.onload = () => {
                                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                                    ctx.drawImage(bgRemovedImg, 0, 0);
                                    applyOverlays(canvas, ctx);
                                    resolve(canvas);
                                };
                                bgRemovedImg.src = URL.createObjectURL(blob);
                            } else {
                                applyOverlays(canvas, ctx);
                                resolve(canvas);
                            }
                        } catch (e) {
                            console.log('Background removal not available, continuing without it');
                            applyOverlays(canvas, ctx);
                            resolve(canvas);
                        }
                    } else {
                        applyOverlays(canvas, ctx);
                        resolve(canvas);
                    }
                };

                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function applyOverlays(canvas, ctx) {
            const width = canvas.width;
            const height = canvas.height;

            // Apply copyright text
            if (document.getElementById('textToggle').checked) {
                const text = document.getElementById('copyrightText').value || '¬© VIERI';
                const fontSize = parseInt(document.getElementById('textSize').value);
                const color = document.getElementById('textColor').value;
                const opacity = parseInt(document.getElementById('textOpacity').value) / 100;
                const position = document.getElementById('textPosition').value;

                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillStyle = hexToRgba(color, opacity);
                ctx.textAlign = 'right';
                ctx.textBaseline = 'bottom';

                const padding = 20;
                let x, y;

                switch(position) {
                    case 'bottom-right':
                        x = width - padding;
                        y = height - padding;
                        break;
                    case 'bottom-left':
                        ctx.textAlign = 'left';
                        x = padding;
                        y = height - padding;
                        break;
                    case 'top-right':
                        x = width - padding;
                        y = padding + fontSize;
                        break;
                    case 'top-left':
                        ctx.textAlign = 'left';
                        x = padding;
                        y = padding + fontSize;
                        break;
                    case 'center':
                        ctx.textAlign = 'center';
                        x = width / 2;
                        y = height / 2;
                        break;
                }

                ctx.fillText(text, x, y);
            }

            // Apply logo
            if (document.getElementById('logoToggle').checked && logoImage) {
                const opacity = parseInt(document.getElementById('logoOpacity').value) / 100;
                const position = document.getElementById('logoPosition').value;
                const size = parseInt(document.getElementById('logoSize').value);

                ctx.globalAlpha = opacity;

                const padding = 20;
                let x, y;
                const aspectRatio = logoImage.width / logoImage.height;
                const logoWidth = size;
                const logoHeight = size / aspectRatio;

                switch(position) {
                    case 'bottom-right':
                        x = width - logoWidth - padding;
                        y = height - logoHeight - padding;
                        break;
                    case 'bottom-left':
                        x = padding;
                        y = height - logoHeight - padding;
                        break;
                    case 'top-right':
                        x = width - logoWidth - padding;
                        y = padding;
                        break;
                    case 'top-left':
                        x = padding;
                        y = padding;
                        break;
                    case 'center':
                        x = (width - logoWidth) / 2;
                        y = (height - logoHeight) / 2;
                        break;
                }

                ctx.drawImage(logoImage, x, y, logoWidth, logoHeight);
                ctx.globalAlpha = 1;
            }
        }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // =========================
        // PROCESSING BUTTON
        // =========================
        async function handleProcess() {
            if (selectedFiles.length === 0) {
                alert(currentLanguage === 'ja' ? 'ÁîªÂÉè„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ' : 'Please select images');
                return;
            }

            // Check daily limit
            if (!canProcessImage()) {
                document.getElementById('limitOverlay').classList.add('active');
                return;
            }

            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = true;
            processBtn.innerHTML = '<span class="loading"></span>' + t('processBtn');

            processedResults = [];

            try {
                for (const file of selectedFiles) {
                    const canvas = await processImage(file);

                    // Generate both formats
                    const pngBlob = await canvasToBlob(canvas, 'image/png');
                    const jpegBlob = await canvasToBlob(canvas, 'image/jpeg');

                    processedResults.push({
                        name: file.name,
                        png: pngBlob,
                        jpeg: jpegBlob,
                        canvas: canvas
                    });

                    if (!isPRO) {
                        incrementDailyUsage();
                        updateUsageBar();
                    }
                }

                // Show results
                displayResults();
                document.getElementById('successMessage').classList.add('show');
                setTimeout(() => {
                    document.getElementById('successMessage').classList.remove('show');
                }, 3000);

            } catch (error) {
                console.error('Processing error:', error);
                alert(currentLanguage === 'ja' ? 'Âá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü' : 'Processing failed');
            } finally {
                processBtn.disabled = false;
                processBtn.innerHTML = t('processBtn');
            }
        }

        function canvasToBlob(canvas, type) {
            return new Promise(resolve => {
                canvas.toBlob(resolve, type);
            });
        }

        function displayResults() {
            const gallery = document.getElementById('gallery');
            const resultsSection = document.getElementById('resultsSection');

            gallery.innerHTML = '';

            processedResults.forEach((result, index) => {
                const item = document.createElement('div');
                item.className = 'gallery-item';

                // Create preview (PNG)
                const previewUrl = URL.createObjectURL(result.png);
                item.innerHTML = `
                    <img class="gallery-image" src="${previewUrl}" alt="${result.name}">
                    <div class="gallery-actions">
                        <div class="gallery-label">${result.name}</div>
                        <div class="download-btns">
                            <button class="download-btn" data-index="${index}" data-format="png">PNG</button>
                            <button class="download-btn" data-index="${index}" data-format="jpeg">JPEG</button>
                        </div>
                    </div>
                `;

                gallery.appendChild(item);
            });

            // Add download handlers
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    const format = e.target.dataset.format;
                    downloadResult(index, format);
                });
            });

            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function downloadResult(index, format) {
            const result = processedResults[index];
            const blob = format === 'png' ? result.png : result.jpeg;
            const ext = format === 'png' ? 'png' : 'jpg';
            const name = result.name.split('.')[0] + '_processed.' + ext;

            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // =========================
        // RESET FUNCTION
        // =========================
        function handleReset() {
            selectedFiles = [];
            logoImage = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('logoInput').value = '';
            document.getElementById('logoFileName').textContent = '';
            document.getElementById('fileCountInfo').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('gallery').innerHTML = '';
        }

        // =========================
        // LANGUAGE TOGGLE
        // =========================
        function setupLanguageToggle() {
            document.getElementById('langToggle').addEventListener('click', () => {
                currentLanguage = currentLanguage === 'ja' ? 'en' : 'ja';
                localStorage.setItem('language', currentLanguage);
                initUI();
            });
        }

        // =========================
        // MODAL HANDLERS
        // =========================
        function setupModalHandlers() {
            const pricingModal = document.getElementById('pricingModal');

            // Open pricing modal
            const openPricingBtns = [
                document.getElementById('heroCtaBtn'),
                document.getElementById('upgradeLimitBtn')
            ];

            openPricingBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    pricingModal.classList.add('active');
                });
            });

            // Close modal
            document.getElementById('closePricingModal').addEventListener('click', () => {
                pricingModal.classList.remove('active');
            });

            document.getElementById('closeLimitBtn').addEventListener('click', () => {
                document.getElementById('limitOverlay').classList.remove('active');
            });

            // PRO selection
            document.getElementById('proSelectBtn').addEventListener('click', () => {
                window.open(CONFIG.STRIPE_PAYMENT_URL, '_blank');
            });

            // Click outside to close
            pricingModal.addEventListener('click', (e) => {
                if (e.target === pricingModal) {
                    pricingModal.classList.remove('active');
                }
            });

            document.getElementById('limitOverlay').addEventListener('click', (e) => {
                if (e.target === document.getElementById('limitOverlay')) {
                    document.getElementById('limitOverlay').classList.remove('active');
                }
            });
        }

        // =========================
        // BUTTON HANDLERS
        // =========================
        function setupButtonHandlers() {
            document.getElementById('processBtn').addEventListener('click', handleProcess);
            document.getElementById('resetBtn').addEventListener('click', handleReset);
        }

        // =========================
        // SERVICE WORKER REGISTRATION
        // =========================
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(err => {
                    console.log('SW registration failed:', err);
                });
            }
        }

        // =========================
        // INITIALIZATION
        // =========================
        document.addEventListener('DOMContentLoaded', () => {
            initUI();
            setupFileHandling();
            setupSettingsHandlers();
            setupLanguageToggle();
            setupModalHandlers();
            setupButtonHandlers();
            registerServiceWorker();
        });
    </script>
</body>
</html>
